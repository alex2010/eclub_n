// Generated by CoffeeScript 1.9.1
module.exports = {
  _init: function(ctx) {
    var btm_opt;
    ctx.css = ctx.cssPath('main');
    ctx.headMenu = 'sns';
    ctx.siteMap = [];
    btm_opt = {
      limit: 10,
      sort: {
        row: -1
      }
    };
    return {
      city: function(cb) {
        return dao.get(ctx.c.code, 'city', {
          title: 'Beijing'
        }, function(res) {
          return cb(null, res);
        });
      },
      menu: function(cb) {
        return dao.get(ctx.c.code, 'role', {
          title: 'guest'
        }, function(res) {
          var i, it, len, menu;
          menu = res.res.menu;
          ctx.foot = res.res.foot;
          for (i = 0, len = menu.length; i < len; i++) {
            it = menu[i];
            it.cls = 'chevron-right';
          }
          return cb(null, menu);
        });
      },
      btm_top: function(cb) {
        return dao.find(ctx.c.code, 'top', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Top Choices',
            items: res,
            row: 10
          });
          return cb(null, res);
        });
      },
      btm_food: function(cb) {
        return dao.find(ctx.c.code, 'food', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Famous Food',
            items: res,
            row: 9
          });
          return cb(null, res);
        });
      },
      btm_show: function(cb) {
        return dao.find(ctx.c.code, 'show', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Beijing Shows',
            items: res,
            row: 8
          });
          return cb(null, res);
        });
      },
      btm_handicraft: function(cb) {
        return dao.find(ctx.c.code, 'handicraft', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Handicrafts',
            items: res,
            row: 7
          });
          return cb(null, res);
        });
      },
      btm_cg: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'cg'
        }, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Cars & Guides',
            items: res,
            row: 6
          });
          return cb(null, res);
        });
      },
      btm_tour: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'tour'
        }, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Tours',
            items: res,
            row: 5
          });
          return cb(null, res);
        });
      },
      btm_map: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'map'
        }, btm_opt, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  index: function(ctx) {
    return {
      sights: function(cb) {
        var filter;
        filter = {
          row: {
            $gt: 1000
          }
        };
        return dao.find(ctx.c.code, 'sight', filter, {}, function(res) {
          return cb(null, res);
        });
      },
      head: function(cb) {
        var filter;
        filter = {
          type: 'index'
        };
        return dao.get(ctx.c.code, 'head', filter, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  top: function(ctx) {
    ctx.headTitle = 'Top Choices In Beijing';
    return {
      topList: function(cb) {
        return dao.find(ctx.c.code, 'top', {}, {}, function(res) {
          return cb(null, res);
        });
      },
      head: function(cb) {
        return dao.get(ctx.c.code, 'head', {
          type: 'top'
        }, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  sight: function(ctx) {
    return {
      recommeded: function(cb) {
        var filter;
        filter = {
          cat: 'top'
        };
        return dao.find(ctx.c.code, 'sight', filter, {}, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  foodList: function(ctx) {
    return {
      food: function(cb) {
        var filter;
        filter = {
          type: 'food'
        };
        return dao.get(ctx.c.code, 'cat', filter, function(res) {
          return cb(null, res);
        });
      },
      foodList: function(cb) {
        return dao.find(ctx.c.code, 'food', {}, {}, function(res) {
          var i, it, len;
          ctx.slides = [];
          for (i = 0, len = res.length; i < len; i++) {
            it = res[i];
            if (it.row > 1000) {
              ctx.slides.push(it);
            }
          }
          return cb(null, res);
        });
      }
    };
  },
  attraction: function(ctx) {
    ctx.pageTitle = "The Attractions in Beijing";
    return {
      headMenu: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'sight'
        }, {}, function(res) {
          var i, it, len;
          for (i = 0, len = res.length; i < len; i++) {
            it = res[i];
            it.href = "/" + it.type + "List?cat=" + it.code;
          }
          return cb(null, res);
        });
      },
      sightList: function(cb) {
        return dao.find(ctx.c.code, 'sight', {}, {}, function(res) {
          return cb(null, res);
        });
      }
    };
  }
};
