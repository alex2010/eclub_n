// Generated by CoffeeScript 1.9.2
module.exports = {
  _init: function(ctx) {
    var btm_opt;
    ctx.css = ctx.cssPath('main');
    ctx.headMenu = 'sns';
    ctx.siteMap = [];
    btm_opt = {
      limit: 10,
      sort: {
        row: -1
      }
    };
    return {
      city: function(cb) {
        return dao.get(ctx.c.code, 'city', {
          title: 'Beijing'
        }, function(res) {
          return cb(null, res);
        });
      },
      menu: function(cb) {
        return dao.get(ctx.c.code, 'role', {
          title: 'guest'
        }, function(res) {
          var i, it, len, menu;
          menu = res.res.menu;
          ctx.foot = res.res.foot;
          for (i = 0, len = menu.length; i < len; i++) {
            it = menu[i];
            it.cls = 'chevron-right';
          }
          return cb(null, menu);
        });
      },
      btm_top: function(cb) {
        return dao.find(ctx.c.code, 'top', {}, btm_opt, function(res) {
          var i, it, len;
          for (i = 0, len = res.length; i < len; i++) {
            it = res[i];
            it._e = it.entity;
            it._id = it.id;
          }
          ctx.siteMap.push({
            title: 'Top Choices',
            items: res,
            row: 10
          });
          return cb(null, res);
        });
      },
      btm_food: function(cb) {
        return dao.find(ctx.c.code, 'food', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Famous Food',
            items: res,
            row: 9
          });
          return cb(null, res);
        });
      },
      btm_show: function(cb) {
        return dao.find(ctx.c.code, 'show', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Beijing Shows',
            items: res,
            row: 8
          });
          return cb(null, res);
        });
      },
      btm_handicraft: function(cb) {
        return dao.find(ctx.c.code, 'handicraft', {}, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Handicrafts',
            items: res,
            row: 7
          });
          return cb(null, res);
        });
      },
      btm_cg: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'cg'
        }, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Cars & Guides',
            items: res,
            row: 6
          });
          return cb(null, res);
        });
      },
      btm_tour: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'tour'
        }, btm_opt, function(res) {
          ctx.siteMap.push({
            title: 'Tours',
            items: res,
            row: 5
          });
          return cb(null, res);
        });
      },
      btm_map: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'map'
        }, btm_opt, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  index: function(ctx) {
    return {
      top: function(cb) {
        var filter;
        filter = {
          type: 'top'
        };
        return dao.get(ctx.c.code, 'head', filter, function(res) {
          return cb(null, res);
        });
      },
      head: function(cb) {
        var filter;
        filter = {
          type: 'index'
        };
        return dao.get(ctx.c.code, 'head', filter, function(res) {
          log('indexxx');
          log(res);
          log('indexxx');
          return cb(null, res);
        });
      }
    };
  },
  top: function(ctx) {
    ctx.headTitle = 'Top Choices In Beijing';
    return {
      topList: function(cb) {
        return dao.find(ctx.c.code, 'top', {}, {}, function(res) {
          return cb(null, res);
        });
      },
      head: function(cb) {
        return dao.get(ctx.c.code, 'head', {
          type: 'top'
        }, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  sight: function(ctx) {
    return {
      headMenu: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: 'sight'
        }, {}, function(res) {
          var i, it, len;
          for (i = 0, len = res.length; i < len; i++) {
            it = res[i];
            it.href = "/itemList?entity=" + it.type + "&cat=" + it.code;
          }
          return cb(null, res);
        });
      },
      allSights: function(cb) {
        return dao.find(ctx.c.code, 'sight', {}, {}, function(res) {
          return cb(null, res);
        });
      },
      recommeded: function(cb) {
        var filter;
        filter = {
          cat: 'top'
        };
        return dao.find(ctx.c.code, 'sight', filter, {}, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  itemList: function(ctx, req) {
    var et;
    et = req.query.entity;
    ctx.title = (et.capitalize()) + " in Beijing";
    ctx._entity = et;
    return {
      _slides: function(cb) {
        var filter;
        if (req.query.cat) {
          return cb();
        } else {
          filter = {
            row: {
              $gt: 1000
            }
          };
          return dao.find(ctx.c.code, et, filter, {}, function(res) {
            return cb(null, res);
          });
        }
      },
      headMenu: function(cb) {
        return dao.find(ctx.c.code, 'cat', {
          type: et
        }, {}, function(res) {
          var i, it, len;
          for (i = 0, len = res.length; i < len; i++) {
            it = res[i];
            it.href = "/itemList?entity=" + it.type + "&cat=" + it.code;
          }
          return cb(null, res);
        });
      },
      item: function(cb) {
        var filter;
        if (req.query.cat) {
          return cb();
        } else {
          filter = {
            type: et
          };
          return dao.get(ctx.c.code, 'cat', filter, function(res) {
            return cb(null, res);
          });
        }
      },
      _items: function(cb) {
        var filter;
        filter = {};
        if (req.query.cat) {
          filter.cat = req.query.cat;
        }
        return dao.find(ctx.c.code, et, filter, {}, function(res) {
          return cb(null, res);
        });
      }
    };
  },
  content: function(ctx, req) {
    return log('zzzzzz');
  }
};
